<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Environmental outlier detection in fish species records. • specleanr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Environmental outlier detection in fish species records.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">specleanr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/eOutlier.html">Environmental outlier detection in fish species records.</a></li>
    <li><a class="dropdown-item" href="../articles/Plants.html">Detecting environmental outliers in species distribution models for plants.</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AnthonyBasooma/specleanr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Environmental outlier detection in fish species records.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AnthonyBasooma/specleanr/blob/master/vignettes/eOutlier.Rmd" class="external-link"><code>vignettes/eOutlier.Rmd</code></a></small>
      <div class="d-none name"><code>eOutlier.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AnthonyBasooma/specleanr" class="external-link">specleanr</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Environemtal outlier check for fish species from the Dnaube
River Basin</strong></p>
<ol style="list-style-type: decimal">
<li><strong>Collate species and environmental datasets</strong></li>
</ol>
<p>The species records were obtained from the archived datasets
extracted from the Joint Danube Survey (<a href="https://www.danubesurvey.org/jds4/" class="external-link uri">https://www.danubesurvey.org/jds4/</a>) and EFIPLUS (Logez
et al., 2012). The Basin layer that was used to get the bounding box of
the Danube Basin was obtained from Hydrography90m (<a href="https://hydrography.org/hydrography90m/hydrography90m_layers" class="external-link uri">https://hydrography.org/hydrography90m/hydrography90m_layers</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#1a. Get basin shapefile to delineate the study region: optional</span></span>
<span></span>
<span><span class="va">danube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/danube/basinfinal.shp'</span>, package <span class="op">=</span> <span class="st">'specleanr'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">danube_basin</span>  <span class="op">&lt;-</span>     <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">danube</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#==========================</span></span>
<span><span class="co">#Step 1b. Obtain Local data sources (Optional if not available)</span></span>
<span><span class="co">#=========================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efidata</span><span class="op">)</span> <span class="co">#Data extract from EFIPLUS data</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">jdsdata</span><span class="op">)</span> <span class="co">#Data extract from JDS4 data </span></span>
<span></span>
<span><span class="co">#==========</span></span>
<span><span class="co">#Step 1c. Download environmental data</span></span>
<span></span>
<span><span class="va">worldclim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/worldclim.tiff'</span>, package <span class="op">=</span> <span class="st">'specleanr'</span><span class="op">)</span></span>
<span><span class="va">worldclim</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">worldclim</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>Harmonizing data and collating species ecological parameters
and nomenclature</strong> #Step 3. Merge local data files #Will also
enable to generate the species list of interest #The efiplus latitude
and longitude are in the standard format names (deimalLatitude and
decimalLongitude), so they will not be changed. During binding of the
two datasets, the column names are harmonised based on the Darwin Core
format (Wieczorek et al., 2012).</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">localdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_datasets.html">match_datasets</a></span><span class="op">(</span>datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>jds<span class="op">=</span><span class="va">jdsdata</span>, efi<span class="op">=</span><span class="va">efidata</span><span class="op">)</span>,</span>
<span>                    lats <span class="op">=</span> <span class="st">'lat'</span>, lons <span class="op">=</span> <span class="st">'lon'</span>, </span>
<span>                    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'speciesname'</span>,<span class="st">'scientificName'</span><span class="op">)</span>,</span>
<span>                    country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'JDS4_site_ID'</span><span class="op">)</span>,</span>
<span>                    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sampling_date'</span>, <span class="st">'Date'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Step 4. Harmonize all the species names by crosschecking with FishBase</span></span>
<span><span class="co">#Keep merge = TRUE to stick a cleaned species names column</span></span>
<span><span class="co">#NAs species will be automatically dropped</span></span>
<span></span>
<span><span class="va">localdf_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_names.html">check_names</a></span><span class="op">(</span><span class="va">localdf</span>, colsp <span class="op">=</span> <span class="st">'species'</span>,verbose <span class="op">=</span> <span class="cn">FALSE</span>, pct <span class="op">=</span> <span class="fl">90</span>, </span>
<span>                             merge <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#==============</span></span>
<span></span>
<span><span class="co">#Retrieve online data from Global Information Facility, VertNET and iNaturalist</span></span>
<span><span class="co">#Note: Using the cleaned species column species</span></span>
<span><span class="co">#If local data sources are NULL or optional, this will be mandatory and vice versa</span></span>
<span></span>
<span><span class="va">lagoco_online</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getdata.html">getdata</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Lampetra planeri'</span>, <span class="st">'Gobio gobio'</span>,<span class="st">'Cottus gobio'</span><span class="op">)</span>, </span>
<span>                                bbox <span class="op">=</span> <span class="va">danube_basin</span>,</span>
<span>                                gbiflim <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                                inatlim <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                                vertlim <span class="op">=</span> <span class="fl">10</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>Further data handling</strong></li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#======================</span></span>
<span><span class="co">#Already online and local data sources prepared</span></span>
<span></span>
<span><span class="co">#1. Online parameter only accepts dataonline class</span></span>
<span><span class="co">#2. The offline lists must be be named</span></span>
<span><span class="co">#======</span></span>
<span></span>
<span><span class="va">onlinedf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_online.html">extract_online</a></span><span class="op">(</span>online <span class="op">=</span> <span class="va">lagoco_online</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#match all data sets</span></span>
<span></span>
<span><span class="va">matchalldf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_datasets.html">match_datasets</a></span><span class="op">(</span>datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>efi<span class="op">=</span> <span class="va">efidata</span>, jds <span class="op">=</span> <span class="va">jdsdata</span>, </span>
<span>                                        onlinedata <span class="op">=</span> <span class="va">onlinedf</span><span class="op">)</span>,</span>
<span>                country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'JDS4_sampling_ID'</span><span class="op">)</span>,</span>
<span>                lats <span class="op">=</span> <span class="st">'lat'</span>,</span>
<span>                lons <span class="op">=</span> <span class="st">'lon'</span>,</span>
<span>                date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sampling_date'</span>, <span class="st">'Date'</span>, <span class="st">'dates'</span>, <span class="st">'date'</span><span class="op">)</span>,</span>
<span>                species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'speciesname'</span>, <span class="st">'scientificName'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Species names are re-cleaned since the species names from vertnet are changed.</span></span>
<span></span>
<span><span class="va">cleandata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_names.html">check_names</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">matchalldf</span>, colsp <span class="op">=</span> <span class="st">'species'</span>, pct <span class="op">=</span> <span class="fl">70</span>, merge <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><strong>Precleaning and environmental data extraction</strong></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#two species</span></span>
<span></span>
<span><span class="co">#Generate lists of species data</span></span>
<span></span>
<span><span class="va">precleaned</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/pred_extract.html">pred_extract</a></span><span class="op">(</span>data<span class="op">=</span> <span class="va">cleandata</span>, </span>
<span>                             raster<span class="op">=</span> <span class="va">worldclim</span>, </span>
<span>                             lat <span class="op">=</span> <span class="st">'decimalLatitude'</span>,</span>
<span>                             lon <span class="op">=</span> <span class="st">'decimalLongitude'</span>,</span>
<span>                             colsp <span class="op">=</span> <span class="st">'speciescheck'</span>,</span>
<span>                             bbox  <span class="op">=</span> <span class="va">danube_basin</span>,  </span>
<span>                             multiple <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             list<span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             minpts <span class="op">=</span> <span class="fl">10</span>, merge <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salmo1</span> <span class="op">&lt;-</span> <span class="va">cleandata</span><span class="op">[</span><span class="va">cleandata</span><span class="op">[</span>,<span class="st">'speciescheck'</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Salmo trutta"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">precleaned1</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/pred_extract.html">pred_extract</a></span><span class="op">(</span>data<span class="op">=</span> <span class="va">salmo1</span>, </span>
<span>                             raster<span class="op">=</span> <span class="va">worldclim</span>, </span>
<span>                             lat <span class="op">=</span> <span class="st">'decimalLatitude'</span>,</span>
<span>                             lon <span class="op">=</span> <span class="st">'decimalLongitude'</span>,</span>
<span>                             colsp <span class="op">=</span> <span class="st">'speciescheck'</span>,</span>
<span>                             bbox  <span class="op">=</span> <span class="va">danube_basin</span>,  </span>
<span>                             multiple <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                             list<span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             minpts <span class="op">=</span> <span class="fl">10</span>, merge <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#For outliers, the output is set to outlier</span></span>
<span></span>
<span><span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multidetect.html">multidetect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">precleaned</span>,</span>
<span>                      multiple <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      var <span class="op">=</span> <span class="st">'bio6'</span>,</span>
<span>                      output <span class="op">=</span> <span class="st">'outlier'</span>,</span>
<span>                     exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span>,</span>
<span>                      methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'zscore'</span>, <span class="st">'adjbox'</span>,<span class="st">'iqr'</span>, <span class="st">'semiqr'</span>,<span class="st">'hampel'</span>,<span class="st">'kmeans'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#single species</span></span>
<span><span class="va">out_df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multidetect.html">multidetect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">precleaned1</span>,</span>
<span>                      multiple <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      var <span class="op">=</span> <span class="st">'bio6'</span>,</span>
<span>                      output <span class="op">=</span> <span class="st">'outlier'</span>,</span>
<span>                      exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span>,</span>
<span>                      methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'zscore'</span>, <span class="st">'adjbox'</span>,<span class="st">'iqr'</span>, <span class="st">'semiqr'</span>,<span class="st">'hampel'</span>,<span class="st">'kmeans'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><strong>Data analysis and visualization</strong></li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_df</span>, y<span class="op">=</span><span class="fl">8</span>, raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="eOutlier_files/figure-html/visualisation-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cleanfishdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data_extract.html">clean_data_extract</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">precleaned</span>, outliers <span class="op">=</span> <span class="va">out_df</span>, threshold <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cleanfishdata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data_extract.html">clean_data_extract</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">precleaned1</span>, outliers <span class="op">=</span> <span class="va">out_df1</span>, threshold <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">modelcompare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelcomparison.html">modelcomparison</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">precleaned1</span>, outliers <span class="op">=</span> <span class="va">out_df1</span>, raster <span class="op">=</span> <span class="va">worldclim</span>, </span>
<span>                                lat <span class="op">=</span> <span class="st">'y'</span>, lon <span class="op">=</span> <span class="st">'x'</span>, full <span class="op">=</span> <span class="cn">FALSE</span>, metrics <span class="op">=</span> <span class="st">'dep'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_performance.html">get_performance</a></span><span class="op">(</span>modeloutput <span class="op">=</span> <span class="va">modelcompare</span><span class="op">)</span></span></code></pre></div>
<p>*<strong>References</strong> 1. Wieczorek, J., Bloom, D., Guralnick,
R., Blum, S., Döring, M., Giovanni, R., Robertson, T., &amp; Vieglais,
D. (2012). Darwin core: An evolving community-developed biodiversity
data standard. PLoS ONE, 7(1). <a href="https://doi.org/10.1371/journal.pone.0029715" class="external-link uri">https://doi.org/10.1371/journal.pone.0029715</a></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by h g.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
